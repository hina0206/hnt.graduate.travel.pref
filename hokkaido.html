<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>北海道 - にほん旅ナビ</title>

  <!-- （任意）Bootstrap を使うなら CDN 読込。なくても動きます -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- 共通CSS -->
  <link rel="stylesheet" href="../css/pref.css">
</head>
<body data-pref="hokkaido"> <!-- ここ変える -->

  <!-- Header（シンプル） -->
  <nav class="site-nav">
    <div class="container">
      <a class="brand" href="https://hina0206.github.io/hnt.graduate.travel.spot/">にほん旅ナビ</a>
      <div class="links">
        <a href="https://hina0206.github.io/hnt.graduate.travel/japan.html">都道府県一覧</a>
        <a href="https://hina0206.github.io/hnt.graduate.travel/tag.html">タグ検索</a>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header class="pref-hero">
    <div class="hero-inner">
      <h1>北海道</h1>
    </div>
  </header>

  <!-- スポットカード表示領域 -->
  <main class="container py-5">
    <div id="spot-cards" class="grid"></div>
  </main>

  <footer class="site-footer">
    <p>&copy; にほん旅ナビ</p>
  </footer>

  <!-- 埋め込みスクリプト（これ1つで動く） -->
  <script>
    (function(){
      // spots.json の公開 URL（自分の GitHub Pages のパスに置き換えて）
      const SPOTS_URL = 'https://hina0206.github.io/hnt.graduate.travel.spot/spots.json';

      // このページの都道府県スラッグ（body[data-pref]）
      const prefSlug = document.body.getAttribute('data-pref'); // ex "hokkaido"

      const container = document.getElementById('spot-cards');

      fetch(SPOTS_URL)
        .then(r => {
          if (!r.ok) throw new Error('spots.json を取得できませんでした');
          return r.json();
        })
        .then(spots => {
          // spots.json の中で prefectureRomaji を使してフィルタ（なければ日本語でマッチ）
          const filtered = spots.filter(s => {
            if (s.prefectureRomaji) return s.prefectureRomaji.toLowerCase() === prefSlug.toLowerCase();
            // fallback: 日本語欄を小文字にして比較（prefSlug がローマ字なら false）
            return false;
          });

          if (filtered.length === 0) {
            container.innerHTML = '<p class="no-result">この都道府県のスポットはまだ登録されていません。</p>';
            return;
          }

          // カードを作って挿入
          filtered.forEach(spot => {
            const col = document.createElement('div');
            col.className = 'card-item';

            // 画像パスは spots.json の mainImage を想定（spotリポジトリ相対 or 絶対URL）
            const img = `<div class="thumb"><img src="${spot.mainImage}" alt="${spot.name}"></div>`;

            // タグバッジ（クリックで tag.html?tag=... に飛ぶ）
            const tags = (spot.tags || []).map(t => `<button class="tag" onclick="event.stopPropagation(); location.href='https://hina0206.github.io/hnt.graduate.travel/tag.html?tag=${encodeURIComponent(t)}'">${t}</button>`).join('');

            col.innerHTML = `
              <div class="card">
                ${img}
                <div class="card-body">
                  <h3 class="card-title">${spot.name}</h3>
                  <p class="card-pref">${spot.prefecture}</p>
                  <div class="card-tags">${tags}</div>
                  <div class="card-cta"><a class="btn" href="../spots/${spot.id}.html">詳細を見る</a></div>
                </div>
              </div>
            `;

            container.appendChild(col);
          });
        })
        .catch(err => {
          console.error(err);
          container.innerHTML = '<p class="no-result">データの読み込みに失敗しました。</p>';
        });
    })();
  </script>
</body>
</html>
